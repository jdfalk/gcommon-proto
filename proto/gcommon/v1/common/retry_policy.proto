// file: proto/gcommon/v1/common/retry_policy.proto
// version: 1.0.0
// guid: 8377a6ed-7891-46dd-9cc3-88fabf03ddf8
edition = "2023";

package gcommon.v1.common;

import "gcommon/v1/common/error_code.proto";
import "google/protobuf/duration.proto";
import "google/protobuf/go_features.proto";
import "buf/validate/validate.proto";


option features.(pb.go).api_level = API_OPAQUE;
option go_package = "github.com/jdfalk/gcommon/sdks/go/v1/common";

/**
 * Retry policy configuration for resilient operation handling.
 * Defines retry behavior with exponential backoff, jitter,
 * and configurable error handling for robust service interactions.
 */
message CommonRetryPolicy {
  // Maximum number of retry attempts (including initial attempt)
  int32 max_attempts = 1 [(buf.validate.field).int32.gte = 0];

  // Initial delay before first retry
  google.protobuf.Duration initial_delay = 2;

  // Maximum delay between retry attempts
  google.protobuf.Duration max_delay = 3;

  // Multiplier for exponential backoff (e.g., 2.0 for doubling)
  double backoff_multiplier = 4 [(buf.validate.field).double.gte = 0.0];

  // Whether to add random jitter to retry timing
  bool enable_jitter = 5;

  // List of error codes that should trigger retries
  repeated ErrorCode retryable_errors = 6 [(buf.validate.field).repeated.min_items = 1];

  // Total timeout for all retry attempts combined
  google.protobuf.Duration total_timeout = 7;
}
